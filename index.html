<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Program MBKM Desa Bangunemo - KAMPUNG IKLIM</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --green:#00796b;
      --green-dark:#004d40;
      --table-head:#009688;
      --bg:#f8f9fa;
      --card-bg:#ffffff;
      --muted:#6b6b6b;
      --accent:#1976d2;
      --danger:#d32f2f;
      --orange:#ff9800;
      --radius:10px;
      --shadow: 0 3px 12px rgba(0,0,0,0.08);
      --gap:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", Tahoma, sans-serif;
      background:var(--bg);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom:40px;
    }

    header{
      background:var(--green);
      color:#fff;
      padding:14px 20px;
      display:flex;
      gap:12px;
      align-items:center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    header img{height:48px;width:48px;object-fit:contain;border-radius:6px;background:#fff;padding:4px}
    header h1{font-size:18px;margin:0;line-height:1.1}
    header p{margin:0;color:rgba(255,255,255,0.9);font-size:13px}

    main{max-width:1100px;margin:20px auto;padding:0 14px;display:grid;gap:18px}
    .card{
      background:var(--card-bg);
      padding:18px;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }
    .card-header h2{margin:0;font-size:16px;color:var(--green)}
    .controls{display:flex;gap:8px;align-items:center}

    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-size:14px;
    }
    .btn.add{background:var(--green);color:#fff}
    .btn.add:hover{background:var(--green-dark)}
    .btn.reset{background:#fff;border:1px solid #eee;color:var(--muted)}
    .btn.small{padding:6px 10px;font-size:13px}

    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
      overflow:hidden;
      border-radius:8px;
    }
    thead tr{background:var(--table-head);color:#fff}
    th,td{padding:10px 12px;border:1px solid #e9e9e9;text-align:left;vertical-align:middle}
    th:first-child, td:first-child { width:60px; text-align:center }
    td.actions{ width:140px; text-align:center }
    tbody tr:nth-child(even){background:#fbfffd}
    tbody tr:hover{background:#f1fff9}

    /* Icon buttons inside table */
    .icon-btn{
      display:inline-grid;
      place-items:center;
      width:36px;height:36px;border-radius:8px;border:0;background:transparent;cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .icon-btn:hover{transform:translateY(-3px)}
    .icon-edit svg{fill:var(--orange);width:20px;height:20px}
    .icon-delete svg{fill:var(--danger);width:20px;height:20px}
    .icon-refresh svg{fill:var(--muted);width:18px;height:18px}
    .icon-view svg{fill:var(--accent);width:18px;height:18px}

    /* Modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:999;align-items:center;justify-content:center;padding:20px}
    .modal.open{display:flex}
    .modal-box{width:100%;max-width:520px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2)}
    .modal-box h3{margin:0 0 10px;color:var(--green)}
    .form-row{display:flex;gap:10px;margin-bottom:10px}
    .form-row .col{flex:1}
    .input, textarea, select{
      width:100%;padding:10px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;
    }
    .modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
    .btn.cancel{background:#efefef;color:#333}
    .btn.save{background:var(--green);color:#fff}

    /* responsive */
    @media (max-width:720px){
      th,td{font-size:13px;padding:8px}
      .controls{flex-direction:column;align-items:flex-end}
    }
  </style>
</head>
<body>

<header>
  <img src="amik.png" alt="Logo Desa" onerror="this.style.display='none'">
  <div>
    <h1>Program MBKM Desa Bangunemo</h1>
    <p>KAMPUNG IKLIM â€” Daftar program & kegiatan desa</p>
  </div>
</header>

<main>

  <!-- CARD: Tabel 1 - Daftar Program Kampung Iklim -->
  <section class="card" id="card-program">
    <div class="card-header">
      <h2>Daftar Program Kampung Iklim</h2>
      <div class="controls">
        <button class="btn add" title="Tambah Program" onclick="openModalFor('program')">
          <!-- plus icon -->
          <svg width="16" height="16" viewBox="0 0 24 24" style="display:inline-block"><path fill="#fff" d="M19 11H13V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
          Tambah Data
        </button>
        <button class="btn reset small" title="Reset semua data program" onclick="resetTable('program')">
          <svg viewBox="0 0 24 24" class="icon-refresh" style="width:16px;height:16px"><path d="M12 6V3L8 7l4 4V8c2.76 0 5 2.24 5 5 0 .34-.03.67-.09 1H20c.06-.33.09-.66.09-1 0-3.87-3.13-7-7-7zM6.09 8C6.03 8.33 6 8.66 6 9c0 3.87 3.13 7 7 7v3l4-4-4-4v3c-2.76 0-5-2.24-5-5 0-.34.03-.67.09-1H6.09z"/></svg>
          Referensi
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <table id="programTable" aria-label="Daftar Program Kampung Iklim">
        <thead>
          <tr>
            <th>No</th>
            <th>Jenis Program</th>
            <th>Contoh Kegiatan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- CARD: Tabel 2 - Kegiatan di Desa -->
  <section class="card" id="card-kegiatan">
    <div class="card-header">
      <h2>Kegiatan di Desa</h2>
      <div class="controls">
        <button class="btn add" title="Tambah Kegiatan" onclick="openModalFor('kegiatan')">
          <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M19 11H13V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
          Tambah Data
        </button>
        <button class="btn reset small" title="Reset semua data kegiatan" onclick="resetTable('kegiatan')">
          <svg viewBox="0 0 24 24" class="icon-refresh" style="width:16px;height:16px"><path d="M12 6V3L8 7l4 4V8c2.76 0 5 2.24 5 5 0 .34-.03.67-.09 1H20c.06-.33.09-.66.09-1 0-3.87-3.13-7-7-7zM6.09 8C6.03 8.33 6 8.66 6 9c0 3.87 3.13 7 7 7v3l4-4-4-4v3c-2.76 0-5-2.24-5-5 0-.34.03-.67.09-1H6.09z"/></svg>
          Referensi
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <table id="kegiatanTable" aria-label="Kegiatan di Desa">
        <thead>
          <tr>
            <th>No</th>
            <th>Program</th>
            <th>Contoh Kegiatan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

</main>

<!-- Modal (reusable for both tables) -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-box" role="document">
    <h3 id="modalTitle">Tambah Data</h3>

    <div class="form-row">
      <div class="col">
        <label class="sr">Jenis / Program</label>
        <input id="field1" class="input" placeholder="Jenis Program / Program" />
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <label class="sr">Contoh Kegiatan</label>
        <input id="field2" class="input" placeholder="Contoh Kegiatan" />
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn cancel" onclick="closeModal()">Batal</button>
      <button class="btn save" onclick="saveModal()">Simpan</button>
    </div>
  </div>
</div>

<script>
  /* ---------- Storage keys ---------- */
  const KEY_PROGRAM = "programData_v1";
  const KEY_KEGIATAN = "kegiatanData_v1";

  /* ---------- state for modal ---------- */
  let modalTarget = null; // 'program' or 'kegiatan'
  let editIndex = null; // null => adding, number => editing

  /* ---------- Elements ---------- */
  const programTbody = document.querySelector("#programTable tbody");
  const kegiatanTbody = document.querySelector("#kegiatanTable tbody");
  const modalEl = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const field1 = document.getElementById("field1");
  const field2 = document.getElementById("field2");

  /* ---------- Utility: SVG action buttons ---------- */
  function btnEdit(index){
    return `<button class="icon-btn icon-edit" title="Edit" onclick="startEdit(${index})" aria-label="Edit">
      <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
    </button>`;
  }
  function btnDelete(){
    return `<button class="icon-btn icon-delete" title="Hapus" onclick="confirmDelete()" aria-label="Hapus">
      <svg viewBox="0 0 24 24"><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-4.5l-1-1z"/></svg>
    </button>`;
  }

  /* ---------- Load & render ---------- */
  function loadData(key){
    try{
      return JSON.parse(localStorage.getItem(key)) || [];
    }catch(e){
      return [];
    }
  }

  function saveData(key, arr){
    localStorage.setItem(key, JSON.stringify(arr));
  }

  function renderTable(key){
    if(key === KEY_PROGRAM){
      const data = loadData(KEY_PROGRAM);
      programTbody.innerHTML = "";
      data.forEach((it, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>${escapeHtml(it.jenis)}</td>
          <td>${escapeHtml(it.kegiatan)}</td>
          <td class="actions">
            <div style="display:inline-flex;gap:8px;align-items:center;justify-content:center">
              <button class="icon-btn icon-edit" title="Edit" onclick="openModalFor('program', ${idx})">${svgPencil()}</button>
              <button class="icon-btn icon-delete" title="Hapus" onclick="deleteItem('program', ${idx})">${svgTrash()}</button>
            </div>
          </td>
        `;
        programTbody.appendChild(tr);
      });
    } else if(key === KEY_KEGIATAN){
      const data = loadData(KEY_KEGIATAN);
      kegiatanTbody.innerHTML = "";
      data.forEach((it, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>${escapeHtml(it.jenis)}</td>
          <td>${escapeHtml(it.kegiatan)}</td>
          <td class="actions">
            <div style="display:inline-flex;gap:8px;align-items:center;justify-content:center">
              <button class="icon-btn icon-edit" title="Edit" onclick="openModalFor('kegiatan', ${idx})">${svgPencil()}</button>
              <button class="icon-btn icon-delete" title="Hapus" onclick="deleteItem('kegiatan', ${idx})">${svgTrash()}</button>
            </div>
          </td>
        `;
        kegiatanTbody.appendChild(tr);
      });
    }
  }

  function renderAll(){
    renderTable(KEY_PROGRAM);
    renderTable(KEY_KEGIATAN);
  }

  /* ---------- Modal handling ---------- */
  // Open modal for specific table; optional editIndex
  function openModalFor(target, idx = null){
    modalTarget = target; // 'program' or 'kegiatan'
    editIndex = (typeof idx === "number") ? idx : null;
    modalTitle.textContent = (editIndex === null ? "Tambah Data" : "Edit Data");
    // fill fields when editing
    if(editIndex !== null){
      const data = (modalTarget === 'program') ? loadData(KEY_PROGRAM) : loadData(KEY_KEGIATAN);
      const item = data[editIndex] || {jenis:"",kegiatan:""};
      field1.value = item.jenis;
      field2.value = item.kegiatan;
    } else {
      field1.value = "";
      field2.value = "";
    }
    modalEl.classList.add("open");
    field1.focus();
  }

  function closeModal(){
    modalEl.classList.remove("open");
    modalTarget = null;
    editIndex = null;
    field1.value = ""; field2.value = "";
  }

  // Save modal to respective storage
  function saveModal(){
    const a = field1.value.trim();
    const b = field2.value.trim();
    if(!a || !b){
      alert("Harap isi semua kolom.");
      return;
    }
    if(modalTarget === 'program'){
      const arr = loadData(KEY_PROGRAM);
      if(editIndex === null){
        arr.push({jenis:a,kegiatan:b});
      } else {
        arr[editIndex] = {jenis:a,kegiatan:b};
      }
      saveData(KEY_PROGRAM, arr);
      renderTable(KEY_PROGRAM);
      closeModal();
    } else if(modalTarget === 'kegiatan'){
      const arr = loadData(KEY_KEGIATAN);
      if(editIndex === null){
        arr.push({jenis:a,kegiatan:b});
      } else {
        arr[editIndex] = {jenis:a,kegiatan:b};
      }
      saveData(KEY_KEGIATAN, arr);
      renderTable(KEY_KEGIATAN);
      closeModal();
    } else {
      alert("Target tidak dikenali.");
    }
  }

  /* ---------- Delete single item ---------- */
  function deleteItem(target, index){
    const confirmMsg = "Yakin ingin menghapus data ini secara permanen?";
    if(!confirm(confirmMsg)) return;
    if(target === 'program'){
      const arr = loadData(KEY_PROGRAM);
      arr.splice(index,1);
      saveData(KEY_PROGRAM, arr);
      renderTable(KEY_PROGRAM);
    } else if(target === 'kegiatan'){
      const arr = loadData(KEY_KEGIATAN);
      arr.splice(index,1);
      saveData(KEY_KEGIATAN, arr);
      renderTable(KEY_KEGIATAN);
    }
  }

  /* ---------- Reset whole table (Referensi) ---------- */
  function resetTable(which){
    const confirmMsg = "Apakah Anda yakin ingin menghapus semua data pada tabel ini?";
    if(!confirm(confirmMsg)) return;
    if(which === 'program'){
      localStorage.removeItem(KEY_PROGRAM);
      renderTable(KEY_PROGRAM);
    } else if(which === 'kegiatan'){
      localStorage.removeItem(KEY_KEGIATAN);
      renderTable(KEY_KEGIATAN);
    }
  }

  /* ---------- helpers ---------- */
  function escapeHtml(s){
    if(!s && s !== 0) return "";
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#39;");
  }

  // SVG icons (keperluan tampilan konsisten & berwarna)
  function svgPencil(){
    return `<svg viewBox="0 0 24 24" width="18" height="18" style="display:block"><path fill="${'#ff9800'}" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>`;
  }
  function svgTrash(){
    return `<svg viewBox="0 0 24 24" width="18" height="18" style="display:block"><path fill="${'#d32f2f'}" d="M6 19c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>`;
  }

  /* ---------- initialization ---------- */
  // Render both tables on load
  window.addEventListener("DOMContentLoaded", () => {
    renderAll();

    // close modal when clicking outside box
    modalEl.addEventListener("click", (e) => {
      if(e.target === modalEl) closeModal();
    });

    // keyboard: Esc to close
    window.addEventListener("keydown", (e) => {
      if(e.key === "Escape") closeModal();
    });
  });

  /* ---------- convenience: support edit from inline button (unused) ---------- */
  function startEdit(index){
    // placeholder if needed
    console.log("startEdit",index);
  }

  /* ---------- Accessibility: visible labels (screen-reader-only) ---------- */
  (function addSrStyles(){
    const style = document.createElement('style');
    style.innerHTML = `.sr{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}`;
    document.head.appendChild(style);
  })();

</script>
</body>
  </html>
